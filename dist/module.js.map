{"version":3,"file":"module.js","mappings":"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","sources":["webpack:///external amd \"react\"","webpack:///external amd \"@grafana/ui\"","webpack:///external amd \"lodash\"","webpack:///external amd \"@grafana/data\"","webpack:///external amd \"@grafana/runtime\"","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./ConfigEditor.tsx","webpack:///./components/Forms.tsx","webpack:///./types.ts","webpack:///./components/QueryEditorModeSwitcher.tsx","webpack:///./QueryEditor.tsx","webpack:///./datasource.ts","webpack:///./module.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","module.exports = __WEBPACK_EXTERNAL_MODULE__5__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import React, { ChangeEvent, PureComponent } from 'react';\nimport { LegacyForms, DataSourceHttpSettings } from '@grafana/ui';\nimport { DataSourcePluginOptionsEditorProps, DataSourceJsonData, DataSourceSettings } from '@grafana/data';\nimport { PIWebAPIDataSourceJsonData } from './types';\n\nconst { FormField } = LegacyForms;\n\ninterface Props extends DataSourcePluginOptionsEditorProps<PIWebAPIDataSourceJsonData, {}> {}\n\nconst coerceOptions = (\n  options: DataSourceSettings<PIWebAPIDataSourceJsonData, {}>\n): DataSourceSettings<PIWebAPIDataSourceJsonData, {}> => {\n  return {\n    ...options,\n    jsonData: {\n      ...options.jsonData,\n      url: options.url,\n    },\n  };\n};\n\ninterface State {}\n\nexport class PIWebAPIConfigEditor extends PureComponent<Props, State> {\n  onPIServerChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      piserver: event.target.value,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onAFServerChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      afserver: event.target.value,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onAFDatabaseChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { onOptionsChange, options } = this.props;\n    const jsonData = {\n      ...options.jsonData,\n      afdatabase: event.target.value,\n    };\n    onOptionsChange({ ...options, jsonData });\n  };\n\n  onMyOptionsChange = (options: DataSourceSettings<DataSourceJsonData, {}>) => {\n    const { onOptionsChange } = this.props;\n    onOptionsChange(coerceOptions(options));\n  };\n\n  render() {\n    const { options: originalOptions } = this.props;\n    const options = coerceOptions(originalOptions);\n\n    return (\n      <div>\n        <DataSourceHttpSettings\n          defaultUrl=\"https://server.name/piwebapi\"\n          dataSourceConfig={options}\n          onChange={this.onMyOptionsChange}\n          showAccessOptions\n        />\n\n        <h3 className=\"page-heading\">PI/AF Connection Details</h3>\n\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form\">\n            <FormField\n              label=\"PI Server\"\n              labelWidth={10}\n              inputWidth={25}\n              onChange={this.onPIServerChange}\n              value={options.jsonData.piserver || ''}\n              placeholder=\"Default PI Server to use for data requests\"\n            />\n          </div>\n          <div className=\"gf-form\">\n            <FormField\n              label=\"AF Server\"\n              labelWidth={10}\n              inputWidth={25}\n              onChange={this.onAFServerChange}\n              value={options.jsonData.afserver || ''}\n              placeholder=\"Default AF Server to use for data requests\"\n            />\n          </div>\n          <div className=\"gf-form\">\n            <FormField\n              label=\"AF Database\"\n              labelWidth={10}\n              inputWidth={25}\n              onChange={this.onAFDatabaseChange}\n              value={options.jsonData.afdatabase || ''}\n              placeholder=\"Default AF Database server for AF queries\"\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { InputHTMLAttributes, FunctionComponent } from 'react';\nimport { InlineFormLabel } from '@grafana/ui';\n\nexport interface Props extends InputHTMLAttributes<HTMLInputElement> {\n  label: string;\n  tooltip?: string;\n  labelWidth?: number;\n  children?: React.ReactNode;\n  queryEditor?: JSX.Element;\n}\n\nexport const QueryField: FunctionComponent<Partial<Props>> = ({ label, labelWidth = 12, tooltip, children }) => (\n  <>\n    <InlineFormLabel width={labelWidth} tooltip={tooltip}>\n      {label}\n    </InlineFormLabel>\n    {children}\n  </>\n);\n\nexport const QueryRowTerminator = () => {\n  return (\n    <div className=\"gf-form gf-form--grow\">\n      <div className=\"gf-form-label gf-form-label--grow\" />\n    </div>\n  );\n};\n\nexport const QueryInlineField = ({ ...props }) => {\n  return (\n    <QueryEditorRow>\n      <QueryField {...props} />\n    </QueryEditorRow>\n  );\n};\n\nexport const QueryEditorRow = (props: Partial<Props>) => {\n  return (\n    <div className=\"gf-form-inline\">\n      {props.children}\n      <QueryRowTerminator />\n    </div>\n  );\n};\n\nexport const QueryRawInlineField = ({ ...props }) => {\n  return (\n    <QueryRawEditorRow>\n      <QueryField {...props} />\n    </QueryRawEditorRow>\n  );\n};\n\nexport const QueryRawEditorRow = (props: Partial<Props>) => {\n  return <>{props.children}</>;\n};\n","import { DataQuery, DataSourceJsonData } from '@grafana/data';\n\nexport interface PIWebAPISelectableValue {\n  webId?: string;\n  value?: string;\n  type?: string;\n  expandable?: boolean;\n}\n\nexport interface PIWebAPIQuery extends DataQuery {\n  target: string;\n  elementPath: string;\n  attributes: any[];\n  segments: any[];\n  display: any;\n  interpolate: any;\n  recordedValues: any;\n  digitalStates: any;\n  enableStreaming: any;\n  webid: string;\n  webids: string[];\n  regex: any;\n  summary: any;\n  expression: string;\n  isPiPoint: boolean;\n  rawQuery?: boolean;\n  query?: string;\n}\n\nexport const defaultQuery: Partial<PIWebAPIQuery> = {\n  target: ';',\n  attributes: [],\n  segments: [],\n  regex: { enable: false },\n  summary: { types: [], basis: 'EventWeighted', interval: '', nodata: 'Null' },\n  expression: '',\n  interpolate: { enable: false },\n  recordedValues: { enable: false },\n  digitalStates: { enable: false },\n  enableStreaming: { enable: true },\n  isPiPoint: false,\n};\n\n/**\n * These are options configured for each DataSource instance\n */\nexport interface PIWebAPIDataSourceJsonData extends DataSourceJsonData {\n  url?: string;\n  access?: string;\n  piserver?: string;\n  afserver?: string;\n  afdatabase?: string;\n}\n\n/**\n * Value that is used in the backend, but never sent over HTTP to the frontend\n */\nexport interface PIWebAPISecureJsonData {\n  apiKey?: string;\n}\n","import React, { useEffect, useState } from 'react';\nimport { Button, ConfirmModal } from '@grafana/ui';\n\ntype Props = {\n  isRaw: boolean;\n  onChange: (newIsRaw: boolean) => void;\n};\n\nexport const QueryEditorModeSwitcher = ({ isRaw, onChange }: Props): JSX.Element => {\n  const [isModalOpen, setModalOpen] = useState(false);\n\n  useEffect(() => {\n    // if the isRaw changes, we hide the modal\n    setModalOpen(false);\n  }, [isRaw]);\n\n  if (isRaw) {\n    return (\n      <>\n        <Button\n          aria-label=\"Switch to visual editor\"\n          icon=\"pen\"\n          variant=\"secondary\"\n          type=\"button\"\n          onClick={() => {\n            // we show the are-you-sure modal\n            setModalOpen(true);\n          }}\n        ></Button>\n        <ConfirmModal\n          isOpen={isModalOpen}\n          title=\"Switch to visual editor mode\"\n          body=\"Are you sure to switch to visual editor mode? You will lose the changes done in raw query mode.\"\n          confirmText=\"Yes, switch to editor mode\"\n          dismissText=\"No, stay in raw query mode\"\n          onConfirm={() => {\n            onChange(false);\n          }}\n          onDismiss={() => {\n            setModalOpen(false);\n          }}\n        />\n      </>\n    );\n  } else {\n    return (\n      <Button\n        aria-label=\"Switch to text editor\"\n        icon=\"pen\"\n        variant=\"secondary\"\n        type=\"button\"\n        onClick={() => {\n          onChange(true);\n        }}\n      ></Button>\n    );\n  }\n};\n","import { each, filter, forOwn, join, reduce, map, slice, remove, defaults } from 'lodash';\n\nimport React, { PureComponent, ChangeEvent } from 'react';\nimport { Icon, InlineField, InlineFieldRow, InlineSwitch, Input, SegmentAsync, Segment } from '@grafana/ui';\nimport { QueryEditorProps, SelectableValue, VariableModel } from '@grafana/data';\n\nimport { PiWebAPIDatasource } from './datasource';\nimport { QueryInlineField, QueryRawInlineField, QueryRowTerminator } from './components/Forms';\nimport { PIWebAPISelectableValue, PIWebAPIDataSourceJsonData, PIWebAPIQuery, defaultQuery } from './types';\nimport { QueryEditorModeSwitcher } from 'components/QueryEditorModeSwitcher';\n\nconst LABEL_WIDTH = 24;\nconst MIN_ELEM_INPUT_WIDTH = 200;\nconst MIN_ATTR_INPUT_WIDTH = 250;\n\ninterface State {\n  isPiPoint: boolean;\n  segments: Array<SelectableValue<PIWebAPISelectableValue>>;\n  attributes: Array<SelectableValue<PIWebAPISelectableValue>>;\n  summaries: Array<SelectableValue<PIWebAPISelectableValue>>;\n  attributeSegment: SelectableValue<PIWebAPISelectableValue>;\n  summarySegment: SelectableValue<PIWebAPISelectableValue>;\n  calculationBasisSegment: SelectableValue<PIWebAPISelectableValue>;\n  noDataReplacementSegment: SelectableValue<PIWebAPISelectableValue>;\n}\n\ntype Props = QueryEditorProps<PiWebAPIDatasource, PIWebAPIQuery, PIWebAPIDataSourceJsonData>;\n\nconst REMOVE_LABEL = '-REMOVE-';\n\nconst CustomLabelComponent = (props: any) => {\n  if (props.value) {\n    return (\n      <div className={`gf-form-label ${props.value.type === 'template' ? 'query-keyword' : ''}`}>\n        {props.label ?? '--no label--'}\n      </div>\n    );\n  }\n  return (\n    <a className=\"gf-form-label query-part\">\n      <Icon name=\"plus\" />\n    </a>\n  );\n};\n\nexport class PIWebAPIQueryEditor extends PureComponent<Props, State> {\n  error: any;\n  piServer: any[] = [];\n  availableAttributes: any = {};\n  summaryTypes: string[];\n  calculationBasis: string[];\n  noDataReplacement: string[];\n  state: State = {\n    isPiPoint: false,\n    segments: [],\n    attributes: [],\n    summaries: [],\n    attributeSegment: {},\n    summarySegment: {},\n    calculationBasisSegment: {},\n    noDataReplacementSegment: {},\n  };\n\n  constructor(props: any) {\n    super(props);\n    this.onSegmentChange = this.onSegmentChange.bind(this);\n    this.calcBasisValueChanged = this.calcBasisValueChanged.bind(this);\n    this.calcNoDataValueChanged = this.calcNoDataValueChanged.bind(this);\n    this.onSummaryAction = this.onSummaryAction.bind(this);\n    this.onSummaryValueChanged = this.onSummaryValueChanged.bind(this);\n    this.onAttributeAction = this.onAttributeAction.bind(this);\n    this.onAttributeChange = this.onAttributeChange.bind(this);\n\n    this.summaryTypes = [\n      // 'None', // A summary type is not specified.\n      'Total', // A totalization over the time range.\n      'Average', // The average value over the time range.\n      'Minimum', // The minimum value over the time range.\n      'Maximum', // The maximum value over the time range.\n      'Range', // The range value over the time range (minimum-maximum).\n      'StdDev', // The standard deviation over the time range.\n      'PopulationStdDev', // The population standard deviation over the time range.\n      'Count', // The sum of event count over the time range when calculation basis is event weighted. The sum of event time duration over the time range when calculation basis is time weighted.\n      'PercentGood', // Percent of data with good value during the calculation period. For time weighted calculations, the percentage is based on time. For event weighted calculations, the percent is based on event count.\n      'All', // A convenience for requesting all available summary calculations.\n      'AllForNonNumeric', // A convenience for requesting all available summary calculations for non-numeric data.\n    ];\n\n    this.calculationBasis = [\n      'TimeWeighted', // Weight the values in the calculation by the time over which they apply. Interpolation is based on whether the attribute is stepped. Interpolated events are generated at the boundaries if necessary.\n      'EventWeighted', // Evaluate values with equal weighting for each event. No interpolation is done. There must be at least one event within the time range to perform a successful calculation. Two events are required for standard deviation. In handling events at the boundary of the calculation, the AFSDK uses following rules:\n      'TimeWeightedContinuous', // Apply weighting as in TimeWeighted, but do all interpolation between values as if they represent continuous data, (standard interpolation) regardless of whether the attribute is stepped.\n      'TimeWeightedDiscrete', // Apply weighting as in TimeWeighted but interpolation between values is performed as if they represent discrete, unrelated values (stair step plot) regardless of the attribute is stepped.\n      'EventWeightedExcludeMostRecentEvent', // The calculation behaves the same as _EventWeighted_, except in the handling of events at the boundary of summary intervals in a multiple intervals calculation. Use this option to prevent events at the intervals boundary from being double count at both intervals. With this option, events at the end time (most recent time) of an interval is not used in that interval.\n      'EventWeightedExcludeEarliestEvent', // Similar to the option _EventWeightedExcludeMostRecentEvent_. Events at the start time(earliest time) of an interval is not used in that interval.\n      'EventWeightedIncludeBothEnds', // Events at both ends of the interval boundaries are included in the event weighted calculation.\n    ];\n\n    this.noDataReplacement = [\n      'Null', // replace with nulls\n      'Drop', // drop items\n      'Previous', // use previous value if available\n      '0', // replace with 0\n      'Keep', // Keep value\n    ];\n  }\n\n  // is selected segment empty\n  isValueEmpty(value: PIWebAPISelectableValue | undefined) {\n    return !value || !value.value || !value.value.length || value.value === REMOVE_LABEL;\n  }\n\n  segmentChangeValue = (segments: Array<SelectableValue<PIWebAPISelectableValue>>) => {\n    const query = this.props.query;\n    this.setState({ segments }, () => this.onChange({ ...query, segments }));\n  };\n\n  attributeChangeValue = (attributes: Array<SelectableValue<PIWebAPISelectableValue>>) => {\n    const query = this.props.query;\n    this.setState({ attributes }, () => this.onChange({ ...query, attributes }));\n  };\n\n  // summary calculation basis change event\n  calcBasisValueChanged(segment: SelectableValue<PIWebAPISelectableValue>) {\n    const metricsQuery = this.props.query as PIWebAPIQuery;\n    const summary = metricsQuery.summary;\n    summary.basis = segment.value?.value;\n    this.onChange({ ...metricsQuery, summary });\n  }\n  // get summary calculation basis user interface segments\n  getCalcBasisSegments() {\n    const segments = map(this.calculationBasis, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n    return segments;\n  }\n\n  // no data change event\n  calcNoDataValueChanged(segment: SelectableValue<PIWebAPISelectableValue>) {\n    const metricsQuery = this.props.query as PIWebAPIQuery;\n    const summary = metricsQuery.summary;\n    summary.nodata = segment.value?.value;\n    this.onChange({ ...metricsQuery, summary });\n  }\n  // get no data user interface segments\n  getNoDataSegments() {\n    var segments = map(this.noDataReplacement, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n    return segments;\n  }\n\n  // summary query change event\n  onSummaryValueChanged(item: SelectableValue<PIWebAPISelectableValue>, index: number) {\n    const summaries = this.state.summaries.slice(0) as Array<SelectableValue<PIWebAPISelectableValue>>;\n    summaries[index] = item;\n    if (this.isValueEmpty(item.value)) {\n      summaries.splice(index, 1);\n    }\n    this.setState({ summaries }, this.stateCallback);\n  }\n  // get the list of summaries available\n  getSummarySegments() {\n    const ctrl = this;\n    const summaryTypes = filter(ctrl.summaryTypes, (type) => {\n      return this.state.summaries.map((s) => s.value?.value).indexOf(type) === -1;\n    });\n    var segments = map(summaryTypes, (item: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item,\n        value: {\n          value: item,\n          expandable: true,\n        },\n      };\n      return selectableValue;\n    });\n\n    segments.unshift({\n      label: REMOVE_LABEL,\n      value: {\n        value: REMOVE_LABEL,\n      },\n    });\n\n    return segments;\n  }\n\n  // remove a summary from the user interface and the query\n  removeSummary(part: SelectableValue<PIWebAPISelectableValue>) {\n    const summaries = filter(this.state.summaries, (item: SelectableValue<PIWebAPISelectableValue>) => {\n      return item !== part;\n    });\n    this.setState({ summaries });\n  }\n  // add a new summary to the query\n  onSummaryAction(item: SelectableValue<PIWebAPISelectableValue>) {\n    const summaries = this.state.summaries.slice(0) as Array<SelectableValue<PIWebAPISelectableValue>>;\n    // if value is not empty, add new attribute segment\n    if (!this.isValueEmpty(item.value)) {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item.label,\n        value: {\n          value: item.value?.value,\n          expandable: true,\n        },\n      };\n      summaries.push(selectableValue);\n    }\n    this.setState({ summarySegment: {}, summaries }, this.stateCallback);\n  }\n\n  // remove an attribute from the query\n  removeAttribute(part: SelectableValue<PIWebAPISelectableValue>) {\n    const attributes = filter(this.state.attributes, (item: SelectableValue<PIWebAPISelectableValue>) => {\n      return item !== part;\n    });\n    this.attributeChangeValue(attributes);\n  }\n  // add an attribute to the query\n  onAttributeAction(item: SelectableValue<PIWebAPISelectableValue>) {\n    const { query } = this.props;\n    const attributes = this.state.attributes.slice(0);\n    // if value is not empty, add new attribute segment\n    if (!this.isValueEmpty(item.value)) {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: item.label,\n        value: {\n          value: item.value?.value,\n          expandable: !query.isPiPoint,\n        },\n      };\n      attributes.push(selectableValue);\n    }\n    this.attributeChangeValue(attributes);\n  }\n\n  // pi point change event\n  onPiPointChange = (item: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n    let attributes = this.state.attributes.slice(0);\n\n    if (item.label === REMOVE_LABEL) {\n      remove(attributes, (value, n) => n === index);\n    } else {\n      // set current value\n      attributes[index] = item;\n    }\n\n    this.checkPiPointSegments(item, attributes);\n  };\n  // attribute change event\n  onAttributeChange = (item: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n    let attributes = this.state.attributes.slice(0);\n\n    // set current value\n    attributes[index] = item;\n\n    this.checkAttributeSegments(attributes, this.state.segments, false);\n  };\n  // segment change\n  onSegmentChange = (item: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n    const { query } = this.props;\n    let segments = this.state.segments.slice(0);\n\n    if (item.label === REMOVE_LABEL) {\n      segments = slice(segments, 0, index);\n      this.checkAttributeSegments([], segments, false);\n      if (segments.length === 0) {\n        segments.push({\n          label: '',\n        });\n      } else if (!!segments[segments.length - 1].value?.expandable) {\n        segments.push({\n          label: 'Select Element',\n          value: {\n            value: '-Select Element-',\n          },\n        });\n      }\n      if (query.isPiPoint) {\n        this.piServer = [];\n      }\n      this.segmentChangeValue(segments);\n      return;\n    }\n\n    // set current value\n    segments[index] = item;\n\n    // Accept only one PI server\n    if (query.isPiPoint) {\n      this.piServer.push(item);\n      this.segmentChangeValue(segments);\n      return;\n    }\n\n    // changed internal selection\n    if (index < segments.length - 1) {\n      segments = slice(segments, 0, index + 1);\n    }\n    this.checkAttributeSegments([], segments, false);\n    // add new options\n    if (!!item.value?.expandable) {\n      segments.push({\n        label: 'Select Element',\n        value: {\n          value: '-Select Element-',\n        },\n      });\n    }\n    this.segmentChangeValue(segments);\n  };\n\n  // get a ui segment for the attributes\n  getElementSegments = (\n    index: number,\n    currentSegment?: Array<SelectableValue<PIWebAPISelectableValue>>\n  ): Promise<Array<SelectableValue<PIWebAPISelectableValue>>> => {\n    const { datasource, query, data } = this.props;\n    var ctrl = this;\n    var findQuery = query.isPiPoint\n      ? { type: 'dataserver' }\n      : { path: this.getSegmentPathUpTo(currentSegment ?? this.state.segments.slice(0), index) };\n\n    if (!query.isPiPoint) {\n      if (datasource.afserver?.name && index === 0) {\n        return Promise.resolve([\n          {\n            label: datasource.afserver.name,\n            value: {\n              value: datasource.afserver.name,\n              expandable: true,\n            },\n          },\n        ]);\n      }\n      if (datasource.afserver?.name && datasource.afdatabase?.name && index === 1) {\n        return Promise.resolve([\n          {\n            label: datasource.afdatabase.name,\n            value: {\n              value: datasource.afdatabase.name,\n              expandable: true,\n            },\n          },\n        ]);\n      }\n\n      // if (!findQuery.path?.length) {\n      //   return Promise.resolve([]);\n      // }\n    }\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: query.isPiPoint }))\n      .then((items: any[]) => {\n        var altSegments = map(items, (item: any) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            label: item.text,\n            value: {\n              webId: item.WebId,\n              value: item.text,\n              expandable: !query.isPiPoint && item.expandable,\n            },\n          };\n          return selectableValue;\n        });\n\n        if (altSegments.length === 0) {\n          return altSegments;\n        }\n\n        // add template variables\n        const variables = datasource.templateSrv.getVariables();\n        each(variables, (variable: VariableModel) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            label: '${' + variable.name + '}',\n            value: {\n              type: 'template',\n              value: '${' + variable.name + '}',\n              expandable: !query.isPiPoint,\n            },\n          };\n          altSegments.unshift(selectableValue);\n        });\n\n        altSegments.unshift({\n          label: REMOVE_LABEL,\n          value: {\n            value: REMOVE_LABEL,\n          },\n        });\n\n        return altSegments;\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        return [];\n      });\n  };\n\n  // get the list of attributes for the user interface - PI\n  getAttributeSegmentsPI = (attributeText?: string): Promise<Array<SelectableValue<PIWebAPISelectableValue>>> => {\n    const { datasource, query, data } = this.props;\n    const ctrl = this;\n    const findQuery = {\n      path: '',\n      webId: this.getSelectedPIServer(),\n      pointName: (attributeText ?? '') + '*',\n      type: 'pipoint',\n    };\n    let segments: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: query.isPiPoint }))\n      .then((items: any[]) => {\n        segments = map(items, (item: any) => {\n          let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n            path: item.Path,\n            label: item.text,\n            value: {\n              value: item.text,\n              expandable: false,\n            },\n          };\n          return selectableValue;\n        });\n        segments.unshift({\n          label: attributeText,\n          value: {\n            value: attributeText,\n            expandable: false,\n          },\n        });\n        segments.unshift({\n          label: REMOVE_LABEL,\n          value: {\n            value: REMOVE_LABEL,\n          },\n        });\n        return segments;\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        return segments;\n      });\n  };\n\n  // get the list of attributes for the user interface - AF\n  getAttributeSegmentsAF = (attributeText?: string): Array<SelectableValue<PIWebAPISelectableValue>> => {\n    const ctrl = this;\n    let segments: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n\n    forOwn(ctrl.availableAttributes, (val: any, key: string) => {\n      let selectableValue: SelectableValue<PIWebAPISelectableValue> = {\n        label: key,\n        value: {\n          value: key,\n          expandable: true,\n        },\n      };\n      segments.push(selectableValue);\n    });\n\n    segments.unshift({\n      label: REMOVE_LABEL,\n      value: {\n        value: REMOVE_LABEL,\n      },\n    });\n\n    return segments;\n  };\n\n  // build data from target string\n  buildFromTarget = (\n    query: PIWebAPIQuery,\n    segmentsArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    attributesArray: Array<SelectableValue<PIWebAPISelectableValue>>\n  ) => {\n    const splitAttributes = query.target.split(';');\n    const splitElements = splitAttributes.length > 0 ? splitAttributes[0].split('\\\\') : [];\n\n    if (splitElements.length > 1 || (splitElements.length === 1 && splitElements[0] !== '')) {\n      // remove element hierarchy from attribute collection\n      splitAttributes.splice(0, 1);\n\n      each(splitElements, (item, _) => {\n        segmentsArray.push({\n          label: item,\n          value: {\n            value: item,\n            expandable: true,\n          },\n        });\n      });\n      each(splitAttributes, (item, _) => {\n        if (item !== '') {\n          // set current value\n          attributesArray.push({\n            label: item,\n            value: {\n              value: item,\n              expandable: false,\n            },\n          });\n        }\n      });\n      return this.getElementSegments(splitElements.length + 1, segmentsArray).then((elements) => {\n        if (elements.length > 0) {\n          segmentsArray.push({\n            label: 'Select Element',\n            value: {\n              value: '-Select Element-',\n            },\n          });\n        }\n        return segmentsArray;\n      });\n    }\n    return Promise.resolve(segmentsArray);\n  };\n\n  /**\n   * Gets the segment information and parses it to a string.\n   *\n   * @param {any} index - Last index of segment to use.\n   * @returns - AF Path or PI Point name.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  getSegmentPathUpTo(segments: Array<SelectableValue<PIWebAPISelectableValue>>, index: number): string {\n    var arr = segments.slice(0, index);\n\n    return reduce(\n      arr,\n      (result: any, segment: SelectableValue<PIWebAPISelectableValue>) => {\n        if (!segment.value) {\n          return '';\n        }\n        if (!segment.value.value?.startsWith('-Select')) {\n          return result ? result + '\\\\' + segment.value.value : segment.value.value;\n        }\n        return result;\n      },\n      ''\n    );\n  }\n\n  /**\n   * Get the current AF Element's child attributes. Validates when the element selection changes.\n   *\n   * @returns - Collection of attributes.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  //FIXME: There is a bug here that removes PI Points from the list of attributes\n  checkAttributeSegments(\n    attributes: Array<SelectableValue<PIWebAPISelectableValue>>,\n    segments: Array<SelectableValue<PIWebAPISelectableValue>>,\n    isPiPoint: boolean\n  ): Promise<any> {\n    const { datasource, data } = this.props;\n    var ctrl = this;\n    var findQuery = {\n      path: this.getSegmentPathUpTo(segments.slice(0), segments.length),\n      type: 'attributes',\n      webId: '',\n      pointName: '',\n    };\n    //FIXME: This is an ugly hack\n    if (isPiPoint) {\n      findQuery.type= 'pipoint'\n      if(segments[0].value?.webId){\n        findQuery.webId = segments[0].value?.webId\n      }\n      if(attributes[0].value?.value){\n        findQuery.pointName = attributes[0].value!.value\n      }\n      };\n    \n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: isPiPoint }))\n      .then((attributesResponse: any) => {\n        var validAttributes: any = {};\n\n        each(attributesResponse, (attribute: any) => {\n          //FIXME: remove console.log\n          console.log(\"604: checkAttributeSegments: attribute: \", attribute)\n          validAttributes[attribute.Path.substring(attribute.Path.indexOf('|') + 1)] = attribute.WebId;\n        });\n        console.log(\"607: validAttributes: \", validAttributes)\n\n        var filteredAttributes = filter(validAttributes, (attrib: SelectableValue<PIWebAPISelectableValue>) => {\n          const changedValue = datasource.templateSrv.replace(attrib.value?.value);\n          return validAttributes[changedValue] !== undefined;\n        });\n        console.log(\"613: filteredAttributes: \", filteredAttributes)\n        ctrl.availableAttributes = validAttributes;\n        if (filteredAttributes.length > 0) {\n          this.attributeChangeValue(filteredAttributes);\n        }\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        this.attributeChangeValue(attributes);\n      });\n  }\n\n  /**\n   * Get PI points from server.\n   *\n   * @returns - Collection of attributes.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  checkPiPointSegments(\n    attribute: SelectableValue<PIWebAPISelectableValue>,\n    attributes: Array<SelectableValue<PIWebAPISelectableValue>>\n  ) {\n    const { datasource, data } = this.props;\n    var ctrl = this;\n    var findQuery = {\n      path: attribute.path,\n      webId: ctrl.getSelectedPIServer(),\n      pointName: attribute.label,\n      type: 'pipoint',\n    };\n    return datasource\n      .metricFindQuery(findQuery, Object.assign(data?.request?.scopedVars ?? {}, { isPiPoint: true }))\n      .then(() => {\n        ctrl.attributeChangeValue(attributes);\n      })\n      .catch((err: any) => {\n        ctrl.error = err.message || 'Failed to issue metric query';\n        ctrl.attributeChangeValue([]);\n      });\n  }\n\n  /**\n   * Gets the webid of the current selected pi data server.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  getSelectedPIServer() {\n    var webID = '';\n\n    this.piServer.forEach((s) => {\n      var parts = this.props.query.target.split(';');\n      if (parts.length >= 2) {\n        if (parts[0] === s.text) {\n          webID = s.WebId;\n          return;\n        }\n      }\n    });\n    return this.piServer.length > 0 ? this.piServer[0].value?.webId : webID;\n  }\n\n  /**\n   * Queries PI Web API for child elements and attributes when the raw query text editor is changed.\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  textEditorChanged() {\n    const { query, onChange } = this.props;\n    const splitAttributes = query.target.split(';');\n    const splitElements = splitAttributes.length > 0 ? splitAttributes[0].split('\\\\') : [];\n\n    let segments: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n    let attributes: Array<SelectableValue<PIWebAPISelectableValue>> = [];\n\n    if (splitElements.length > 1 || (splitElements.length === 1 && splitElements[0] !== '')) {\n      // remove element hierarchy from attribute collection\n      splitAttributes.splice(0, 1);\n\n      each(splitElements, (item, _) => {\n        segments.push({\n          label: item,\n          value: {\n            type: item.match(/\\${\\w+}/gi) ? 'template' : undefined,\n            value: item,\n            expandable: true,\n          },\n        });\n      });\n      this.getElementSegments(splitElements.length + 1, segments).then((elements) => {\n        if (elements.length > 0) {\n          segments.push({\n            label: 'Select Element',\n            value: {\n              value: '-Select Element-',\n            },\n          });\n        }\n      });\n      each(splitAttributes, function (item, index) {\n        if (item !== '') {\n          attributes.push({\n            label: item,\n            value: {\n              value: item,\n              expandable: false,\n            },\n          });\n        }\n      });\n      this.updateArray(segments, attributes, this.state.summaries, query.isPiPoint, () => {\n        onChange({ ...query, query: undefined, rawQuery: false });\n      });\n    } else {\n      segments = this.checkAfServer();\n      this.updateArray(segments, this.state.attributes, this.state.summaries, query.isPiPoint, () => {\n        this.onChange({\n          ...query,\n          query: undefined,\n          rawQuery: false,\n          attributes: this.state.attributes,\n          segments: this.state.segments,\n        });\n      });\n    }\n  }\n\n  /**\n   * Check if the AF server and database are configured in the datasoure config.\n   *\n   * @returns the segments array\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  checkAfServer = () => {\n    const { datasource } = this.props;\n    const segmentsArray = [];\n    if (datasource.afserver?.name) {\n      segmentsArray.push({\n        label: datasource.afserver.name,\n        value: {\n          value: datasource.afserver.name,\n          expandable: true,\n        },\n      });\n      if (datasource.afdatabase?.name) {\n        segmentsArray.push({\n          label: datasource.afdatabase.name,\n          value: {\n            value: datasource.afdatabase.name,\n            expandable: true,\n          },\n        });\n      }\n      segmentsArray.push({\n        label: 'Select Element',\n        value: {\n          value: '-Select Element-',\n        },\n      });\n    } else {\n      segmentsArray.push({\n        label: '',\n      });\n    }\n    return segmentsArray;\n  };\n\n  /**\n   * Update the internal state of the datasource.\n   *\n   * @param segmentsArray the segments array to update\n   * @param attributesArray the AF attributes array to update\n   * @param summariesArray the summaries array to update\n   * @param isPiPoint the is PI point flag\n   * @param cb optional callback function\n   *\n   * @memberOf PIWebAPIQueryEditor\n   */\n  updateArray = (\n    segmentsArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    attributesArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    summariesArray: Array<SelectableValue<PIWebAPISelectableValue>>,\n    isPiPoint: boolean,\n    cb?: (() => void) | undefined\n  ) => {\n    this.setState(\n      {\n        segments: segmentsArray,\n        attributes: attributesArray,\n        summaries: summariesArray,\n        isPiPoint,\n      },\n      () =>\n        this.checkAttributeSegments(attributesArray, this.state.segments, isPiPoint).then(() => {\n          if (cb) {\n            cb();\n          }\n        })\n    );\n  };\n\n  // React action when component is initialized/updated\n  scopedVarsDone = false;\n  componentDidMount = () => {\n    this.initialLoad(false);\n  };\n\n  componentDidUpdate = () => {\n    const { query } = this.props;\n    if (this.props.data?.state === 'Done' && !!this.props.data?.request?.scopedVars && !this.scopedVarsDone) {\n      this.scopedVarsDone = true;\n      this.initialLoad(!query.isPiPoint);\n    }\n  };\n\n  initialLoad = (force: boolean) => {\n    const { query } = this.props;\n    const metricsQuery = defaults(query, defaultQuery) as PIWebAPIQuery;\n    const { segments, attributes, summary, isPiPoint } = metricsQuery;\n\n    let segmentsArray: Array<SelectableValue<PIWebAPISelectableValue>> = force ? [] : segments?.slice(0) ?? [];\n    let attributesArray: Array<SelectableValue<PIWebAPISelectableValue>> = force ? [] : attributes?.slice(0) ?? [];\n    let summariesArray = summary?.types ?? [];\n\n    if (!isPiPoint && segmentsArray.length === 0) {\n      if (query.target && query.target.length > 0 && query.target !== ';') {\n        attributesArray = [];\n        // Build query from target\n        this.buildFromTarget(query, segmentsArray, attributesArray)\n          .then((_segmentsArray) => {\n            this.updateArray(_segmentsArray, attributesArray, summariesArray, isPiPoint);\n          })\n          .catch((e) => console.error(e));\n        return;\n      } else {\n        segmentsArray = this.checkAfServer();\n      }\n    } else if (isPiPoint && segmentsArray.length > 0) {\n      this.piServer = segmentsArray;\n    }\n\n    this.updateArray(segmentsArray, attributesArray, summariesArray, isPiPoint, () => {\n      this.onChange(query);\n    });\n  };\n\n  onChange = (query: PIWebAPIQuery) => {\n    const { onChange, onRunQuery } = this.props;\n\n    query.summary.types = this.state.summaries;\n    if (query.rawQuery) {\n      query.target = query.query ?? '';\n\n      if (query.target !== '') {\n        const splitAttributes = query.target.split(';');\n        const splitElements = splitAttributes[0].split('\\\\');\n\n        // remove element hierarchy from attribute collection\n        splitAttributes.splice(0, 1);\n\n        query.attributes = [];\n        if (splitElements.length > 1 || (splitElements.length === 1 && splitElements[0] !== '')) {\n          query.elementPath = splitElements.join('\\\\');\n          each(splitAttributes, function (item, index) {\n            if (item !== '') {\n              query.attributes.push({\n                label: item,\n                value: {\n                  value: item,\n                  expandable: false,\n                },\n              });\n            }\n          });\n        }\n      }\n\n      //console.log(query.elementPath);\n    } else {\n      query.elementPath = this.getSegmentPathUpTo(this.state.segments, this.state.segments.length);\n      query.target =\n        query.elementPath +\n        ';' +\n        join(\n          query.attributes.map((s) => s.value?.value),\n          ';'\n        );\n\n        //console.log(query.elementPath);\n    }\n\n    onChange(query);\n\n    if (query.target && query.target.length > 0 && query.attributes.length > 0) {\n      onRunQuery();\n    }\n  };\n\n  stateCallback = () => {\n    const query = this.props.query as PIWebAPIQuery;\n    this.onChange(query);\n  };\n\n  onIsPiPointChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n    const { query: queryChange } = this.props;\n    const isPiPoint = !queryChange.isPiPoint;\n    this.setState(\n      {\n        segments: isPiPoint ? [{ label: '' }] : this.checkAfServer(),\n        attributes: [],\n        isPiPoint,\n      },\n      () => {\n        this.onChange({\n          ...queryChange,\n          expression: '',\n          attributes: this.state.attributes,\n          segments: this.state.segments,\n          isPiPoint,\n        });\n      }\n    );\n  };\n\n  render() {\n    const { query: queryProps, onChange, onRunQuery } = this.props;\n    const metricsQuery = defaults(queryProps, defaultQuery) as PIWebAPIQuery;\n    const {\n      interpolate,\n      query,\n      rawQuery,\n      enableStreaming,\n      recordedValues,\n      expression,\n      isPiPoint,\n      summary,\n      display,\n      regex,\n    } = metricsQuery;\n\n    return (\n      <>\n        <InlineField label=\"Is Pi Point?\" labelWidth={LABEL_WIDTH}>\n          <InlineSwitch value={isPiPoint} onChange={this.onIsPiPointChange} />\n        </InlineField>\n\n        {!!rawQuery && (\n          <InlineFieldRow>\n            <InlineField label=\"Raw Query\" labelWidth={LABEL_WIDTH} grow={true}>\n              <Input\n                onBlur={this.stateCallback}\n                value={query}\n                onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                  onChange({ ...metricsQuery, query: event.target.value })\n                }\n                placeholder=\"enter query\"\n              />\n            </InlineField>\n            <QueryEditorModeSwitcher isRaw={true} onChange={(value: boolean) => this.textEditorChanged()} />\n          </InlineFieldRow>\n        )}\n\n        {!rawQuery && (\n          <>\n            <div className=\"gf-form-inline\">\n              <QueryRawInlineField\n                label={isPiPoint ? 'PI Server' : 'AF Elements'}\n                tooltip={isPiPoint ? 'Select PI server.' : 'Select AF Element.'}\n              >\n                {this.state.segments.map((segment: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n                  return (\n                    <SegmentAsync\n                      key={'element-' + index}\n                      Component={<CustomLabelComponent value={segment.value} label={segment.label} />}\n                      onChange={(item) => this.onSegmentChange(item, index)}\n                      loadOptions={(query?: string | undefined) => {\n                        return this.getElementSegments(index);\n                      }}\n                      allowCustomValue\n                      inputMinWidth={MIN_ELEM_INPUT_WIDTH}\n                    />\n                  );\n                })}\n                <QueryRowTerminator />\n                {!isPiPoint && (\n                  <QueryEditorModeSwitcher\n                    isRaw={false}\n                    onChange={(value: boolean) => {\n                      onChange({ ...metricsQuery, query: metricsQuery.target, rawQuery: value });\n                    }}\n                  />\n                )}\n              </QueryRawInlineField>\n            </div>\n\n            <QueryInlineField label={isPiPoint ? 'Pi Points' : 'Attributes'}>\n              {this.state.attributes.map((attribute: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n                if (isPiPoint) {\n                  return (\n                    <SegmentAsync\n                      key={'attributes-' + index}\n                      Component={<CustomLabelComponent value={attribute.value} label={attribute.label} />}\n                      disabled={this.piServer.length === 0}\n                      onChange={(item) => this.onPiPointChange(item, index)}\n                      loadOptions={this.getAttributeSegmentsPI}\n                      reloadOptionsOnChange\n                      allowCustomValue\n                      inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                    />\n                  );\n                }\n                return (\n                  <Segment\n                    key={'attributes-' + index}\n                    Component={<CustomLabelComponent value={attribute.value} label={attribute.label} />}\n                    disabled={this.state.segments.length <= 2}\n                    onChange={(item) => this.onAttributeChange(item, index)}\n                    options={this.getAttributeSegmentsAF()}\n                    allowCustomValue\n                    inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                  />\n                );\n              })}\n\n              {isPiPoint && (\n                <SegmentAsync\n                  Component={\n                    <CustomLabelComponent\n                      value={this.state.attributeSegment.value}\n                      label={this.state.attributeSegment.label}\n                    />\n                  }\n                  disabled={this.piServer.length === 0}\n                  onChange={this.onAttributeAction}\n                  loadOptions={this.getAttributeSegmentsPI}\n                  reloadOptionsOnChange\n                  allowCustomValue\n                  inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                />\n              )}\n              {!isPiPoint && (\n                <Segment\n                  Component={\n                    <CustomLabelComponent\n                      value={this.state.attributeSegment.value}\n                      label={this.state.attributeSegment.label}\n                    />\n                  }\n                  disabled={this.state.segments.length <= 2}\n                  onChange={this.onAttributeAction}\n                  options={this.getAttributeSegmentsAF()}\n                  allowCustomValue\n                  inputMinWidth={MIN_ATTR_INPUT_WIDTH}\n                />\n              )}\n            </QueryInlineField>\n          </>\n        )}\n\n        {!isPiPoint && (\n          <InlineField\n            label=\"Calculation\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={\n              \"Modify all attributes by an equation. Use '.' for current item. Leave Attributes empty if you wish to perform element based calculations.\"\n            }\n          >\n            <Input\n              onBlur={onRunQuery}\n              value={expression}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                this.onChange({ ...metricsQuery, expression: event.target.value })\n              }\n              placeholder=\"'.'*2\"\n            />\n          </InlineField>\n        )}\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Max Recorded Values\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={'Maximum number of recorded value to retrive from the data archive, without using interpolation.'}\n          >\n            <Input\n              onBlur={onRunQuery}\n              value={recordedValues.maxNumber}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                this.onChange({\n                  ...metricsQuery,\n                  recordedValues: { ...recordedValues, maxNumber: parseInt(event.target.value, 10) },\n                })\n              }\n              type=\"number\"\n              placeholder=\"1000\"\n            />\n          </InlineField>\n          <InlineField label=\"Recorded Values\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch\n              value={recordedValues.enable}\n              onChange={() =>\n                this.onChange({\n                  ...metricsQuery,\n                  recordedValues: { ...recordedValues, enable: !recordedValues.enable },\n                })\n              }\n            />\n          </InlineField>\n          <InlineField label=\"Enable Streaming\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch\n              value={enableStreaming.enable}\n              onChange={() =>\n                this.onChange({ ...metricsQuery, enableStreaming: { ...enableStreaming, enable: !enableStreaming.enable } })\n              }\n            />\n          </InlineField>\n        </InlineFieldRow>\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Interpolate Period\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={\"Override time between sampling, e.g. '30s'. Defaults to timespan/chart width.\"}\n          >\n            <Input\n              onBlur={onRunQuery}\n              value={interpolate.interval}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                this.onChange({ ...metricsQuery, interpolate: { ...interpolate, interval: event.target.value } })\n              }\n              placeholder=\"30s\"\n            />\n          </InlineField>\n          <InlineField label=\"Interpolate\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch\n              value={interpolate.enable}\n              onChange={() =>\n                this.onChange({ ...metricsQuery, interpolate: { ...interpolate, enable: !interpolate.enable } })\n              }\n            />\n          </InlineField>\n          <InlineField\n            label=\"Replace Bad Data\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={'Replacement for bad quality values.'}\n          >\n            <Segment\n              Component={<CustomLabelComponent value={{ value: summary.nodata }} label={summary.nodata} />}\n              onChange={this.calcNoDataValueChanged}\n              options={this.getNoDataSegments()}\n              allowCustomValue\n            />\n          </InlineField>\n        </InlineFieldRow>\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Summary Period\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={\"Override time between sampling, e.g. '30s'.\"}\n          >\n            <Input\n              onBlur={onRunQuery}\n              value={summary.interval}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                onChange({ ...metricsQuery, summary: { ...summary, interval: event.target.value } })\n              }\n              placeholder=\"30s\"\n            />\n          </InlineField>\n          <InlineField\n            label=\"Basis\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={\n              'Defines the possible calculation options when performing summary calculations over time-series data.'\n            }\n          >\n            <Segment\n              Component={<CustomLabelComponent value={{ value: summary.basis }} label={summary.basis} />}\n              onChange={this.calcBasisValueChanged}\n              options={this.getCalcBasisSegments()}\n              allowCustomValue\n            />\n          </InlineField>\n          <InlineField label=\"Summaries\" labelWidth={LABEL_WIDTH} tooltip={'Replacement for bad quality values.'}>\n            <InlineFieldRow>\n              {this.state.summaries.map((s: SelectableValue<PIWebAPISelectableValue>, index: number) => {\n                return (\n                  <Segment\n                    key={'summaries-' + index}\n                    Component={<CustomLabelComponent value={s.value} label={s.label} />}\n                    onChange={(item) => this.onSummaryValueChanged(item, index)}\n                    options={this.getSummarySegments()}\n                    allowCustomValue\n                  />\n                );\n              })}\n              <Segment\n                Component={\n                  <CustomLabelComponent\n                    value={this.state.summarySegment.value}\n                    label={this.state.summarySegment.label}\n                  />\n                }\n                onChange={this.onSummaryAction}\n                options={this.getSummarySegments()}\n                allowCustomValue\n              />\n            </InlineFieldRow>\n          </InlineField>\n        </InlineFieldRow>\n\n        <InlineFieldRow>\n          <InlineField\n            label=\"Display Name\"\n            labelWidth={LABEL_WIDTH}\n            tooltip={'If single attribute, modify display name. Otherwise use regex to modify display name.'}\n          >\n            <Input\n              onBlur={onRunQuery}\n              value={display}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                this.onChange({ ...metricsQuery, display: event.target.value })\n              }\n              placeholder=\"Display\"\n            />\n          </InlineField>\n          <InlineField label=\"Enable Regex Replace\" labelWidth={LABEL_WIDTH}>\n            <InlineSwitch\n              value={regex.enable}\n              onChange={() => {\n                this.onChange({ ...metricsQuery, regex: { ...regex, enable: !regex.enable } });\n              }}\n            />\n          </InlineField>\n          <InlineField label=\"Search\" labelWidth={LABEL_WIDTH - 8}>\n            <Input\n              onBlur={onRunQuery}\n              value={regex.search}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                this.onChange({ ...metricsQuery, regex: { ...regex, search: event.target.value } })\n              }\n              placeholder=\"(.*)\"\n            />\n          </InlineField>\n          <InlineField label=\"Replace\" labelWidth={LABEL_WIDTH - 8}>\n            <Input\n              onBlur={onRunQuery}\n              value={regex.replace}\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\n                this.onChange({ ...metricsQuery, regex: { ...regex, replace: event.target.value } })\n              }\n              placeholder=\"$1\"\n            />\n          </InlineField>\n        </InlineFieldRow>\n      </>\n    );\n  }\n}\n","import * as lodash from 'lodash';\nimport { DataSourceInstanceSettings, MetricFindValue} from '@grafana/data';\nimport { DataSourceWithBackend, getTemplateSrv, getBackendSrv, TemplateSrv } from '@grafana/runtime';\nimport { PIWebAPIQuery, PIWebAPIDataSourceJsonData } from './types';\n// TODO: Remove depricated calls and replace with rxjs fetch\n//import { lastValueFrom } from 'rxjs';\n\ninterface PiDataServer {\n  name: string | undefined;\n  webid: string | undefined;\n}\n\nexport interface PiwebapiRsp {\n  Name?: string;\n  InstanceType?: string;\n  Items?: PiwebapiRsp[];\n  WebId?: string;\n  HasChildren?: boolean;\n  Path?: string;\n}\n\nexport interface PiwebapiInternalRsp {\n  data: PiwebapiRsp;\n  status: number;\n  url: string;\n}\n\nexport class PiWebAPIDatasource extends DataSourceWithBackend<PIWebAPIQuery, PIWebAPIDataSourceJsonData> {\n  piserver: PiDataServer;\n  afserver: PiDataServer;\n  afdatabase: PiDataServer;\n  templateSrv: TemplateSrv;\n  \n  constructor(instanceSettings: DataSourceInstanceSettings<PIWebAPIDataSourceJsonData>) {\n    super(instanceSettings);\n    this.templateSrv = getTemplateSrv();\n    this.piserver = { name: (instanceSettings.jsonData || {}).piserver, webid: undefined };\n    this.afserver = { name: (instanceSettings.jsonData || {}).afserver, webid: undefined };\n    this.afdatabase = { name: (instanceSettings.jsonData || {}).afdatabase, webid: undefined };\n    this.annotations = {};\n  }\n\n\n  /**\n   * This method does the discovery of the AF Hierarchy and populates the query user interface segments.\n   *\n   * @param {any} query - Parses the query configuration and builds a PI Web API query.\n   * @returns - Segment information.\n   *\n   * @memberOf PiWebApiDatasource\n   */\n\n  async metricFindQuery(query: any, queryOptions: any): Promise<MetricFindValue[]> {\n    let ds = this;\n    let querydepth = ['servers', 'databases', 'databaseElements', 'elements'];\n    if (typeof query === 'string') {\n      query = JSON.parse(query as string);\n    }\n    if (queryOptions.isPiPoint) {\n      query.path = this.templateSrv.replace(query.path, queryOptions);\n    } else {\n      if (query.path === '') {\n        query.type = querydepth[0];\n      } else if (query.type !== 'attributes') {\n        query.type = querydepth[Math.max(0, Math.min(query.path.split('\\\\').length, querydepth.length - 1))];\n      }\n      query.path = this.templateSrv.replace(query.path, queryOptions);\n      query.path = query.path.replace(/\\{([^\\\\])*\\}/gi, (r: string) => r.substring(1, r.length - 2).split(',')[0]);\n    }\n\n    query.filter = query.filter ?? '*';\n\n\n    if (query.type === 'servers') {\n      return ds.afserver?.name\n        ? ds.getAssetServer(ds.afserver.name)\n            .then((result: PiwebapiRsp) => [result])\n            .then(ds.metricQueryTransform)\n        : ds.getAssetServers().then(ds.metricQueryTransform);\n    } \n    else if (query.type === 'databases') {\n      return ds\n        .getAssetServer(query.path)\n        .then((server) => ds.getDatabases(server.WebId ?? '', {}))\n        .then(ds.metricQueryTransform);\n    } \n    else if (query.type === 'databaseElements') {\n      return ds\n        .getDatabase(query.path)\n        .then((db) =>\n          ds.getDatabaseElements(db.WebId ?? '', {\n            selectedFields: 'Items.WebId%3BItems.Name%3BItems.Items%3BItems.Path%3BItems.HasChildren',\n          })\n        )\n        .then(ds.metricQueryTransform);\n    } \n    else if (query.type === 'elements') {\n      return ds\n        .getElement(query.path)\n        .then((element) =>\n          ds.getElements(element.WebId ?? '', {\n            selectedFields: `Items.WebId%3BItems.Name%3BItems.Items%3BItems.Path%3BItems.HasChildren`,\n            nameFilter: query.filter,\n          })\n        )\n        .then(ds.metricQueryTransform);\n    } \n    else if (query.type === 'attributes') {\n      return ds\n        .getElement(query.path)\n        .then((element) =>\n          ds.getAttributes(element.WebId ?? '', {\n            searchFullHierarchy: 'true',\n            selectedFields: `Items.WebId%3BItems.Name%3BItems.Path`,\n            nameFilter: query.filter,\n          })\n        )\n        .then(ds.metricQueryTransform);\n    } \n    else if (query.type === 'dataserver') {\n      return ds.getDataServers().then(ds.metricQueryTransform);\n    } \n    else if (query.type === 'pipoint') {\n      return ds.piPointSearch(query.webId, query.pointName).then(ds.metricQueryTransform);\n    }\n    return Promise.reject('Bad type');\n  }\n\n  applyTemplateVariables(query: PIWebAPIQuery): PIWebAPIQuery {\n    if (!query || !query.query) {\n      return query;\n    }\n\n    return {\n      ...query,\n      query: getTemplateSrv().replace(query.query),\n    };\n  }\n\n/**\n * Builds the Grafana metric segment for use on the query user interface.\n *\n * @param {any} response - response from PI Web API.\n * @returns {MetricFindValue[]} - Grafana metric segment.\n *\n * @memberOf PiWebApiDatasource\n */\nprivate metricQueryTransform(response: PiwebapiRsp[]): MetricFindValue[] {\n  return lodash.map(response, (item) => {\n    return {\n      text: item.Name,\n      expandable: item.HasChildren === undefined || item.HasChildren === true || (item.Path ?? '').split('\\\\').length <= 3,\n      HasChildren: item.HasChildren,\n      Items: item.Items ?? [],\n      Path: item.Path,\n      WebId: item.WebId,\n    } as MetricFindValue;\n  });\n}\n\n/**\n * Abstraction for calling the PI Web API REST endpoint\n *\n * @param {string} path - the path to append to the base server URL.\n * @returns {Promise<PiwebapiInternalRsp>} - The full URL.\n *\n * @memberOf PiWebApiDatasource\n */\nprivate restGet(path: string): Promise<PiwebapiInternalRsp> {\n  return getBackendSrv()\n    .datasourceRequest({\n      url: `/api/datasources/${this.id}/resources/${path}`,\n      method: 'GET',\n      headers: { 'Content-Type': 'application/json' },\n    })\n    .then((response: any) => {\n      return response as PiwebapiInternalRsp;\n    });\n}\n\n  // Get a list of all data (PI) servers\n  private getDataServers(): Promise<PiwebapiRsp[]> {\n    return this.restGet('/dataservers').then((response) => response.data.Items ?? []);\n  }\n  // private getDataServer(name: string | undefined): Promise<PiwebapiRsp> {\n  //   if (!name) {\n  //     return Promise.resolve({});\n  //   }\n  //   return this.restGet('/dataservers?name=' + name).then((response) => response.data);\n  // }\n\n  \n  // Get a list of all asset (AF) servers\n  private getAssetServers(): Promise<PiwebapiRsp[]> {\n    return this.restGet('/assetservers').then((response) => response.data.Items ?? []);\n  }\n\n  private getAssetServer(name: string | undefined): Promise<PiwebapiRsp> {\n    if (!name) {\n      return Promise.resolve({});\n    }\n    return this.restGet('/assetservers?path=\\\\\\\\' + name).then((response) => response.data);\n  }\n  private getDatabase(path: string | undefined): Promise<PiwebapiRsp> {\n    if (!path) {\n      return Promise.resolve({});\n    }\n    return this.restGet('/assetdatabases?path=\\\\\\\\' + path).then((response) => response.data);\n  }\n  getDatabases(serverId: string, options?: any): Promise<PiwebapiRsp[]> {\n    if (!serverId) {\n      return Promise.resolve([]);\n    }\n    return this.restGet('/assetservers/' + serverId + '/assetdatabases').then((response) => response.data.Items ?? []);\n  }\n  getElement(path: string): Promise<PiwebapiRsp> {\n    if (!path) {\n      return Promise.resolve({});\n    }\n    console.log(\"datasource.getElement: \", path)\n    return this.restGet('/elements?path=\\\\\\\\' + path).then((response) => response.data);\n  }\n  getEventFrameTemplates(databaseId: string): Promise<PiwebapiRsp[]> {\n    if (!databaseId) {\n      return Promise.resolve([]);\n    }\n    return this.restGet(\n      '/assetdatabases/' + databaseId + '/elementtemplates?selectedFields=Items.InstanceType%3BItems.Name%3BItems.WebId'\n    ).then((response) => {\n      return lodash.filter(response.data.Items ?? [], (item) => item.InstanceType === 'EventFrame');\n    });\n  }\n  getElementTemplates(databaseId: string): Promise<PiwebapiRsp[]> {\n    if (!databaseId) {\n      return Promise.resolve([]);\n    }\n    return this.restGet(\n      '/assetdatabases/' + databaseId + '/elementtemplates?selectedFields=Items.InstanceType%3BItems.Name%3BItems.WebId'\n    ).then((response) => {\n      return lodash.filter(response.data.Items ?? [], (item) => item.InstanceType === 'Element');\n    });\n  }\n\n  /**\n   * @description\n   * Get the child attributes of the current resource.\n   * GET attributes/{webId}/attributes\n   * @param {string} elementId - The ID of the parent resource. See WebID for more information.\n   * @param {Object} options - Query Options\n   * @param {string} options.nameFilter - The name query string used for finding attributes. The default is no filter. See Query String for more information.\n   * @param {string} options.categoryName - Specify that returned attributes must have this category. The default is no category filter.\n   * @param {string} options.templateName - Specify that returned attributes must be members of this template. The default is no template filter.\n   * @param {string} options.valueType - Specify that returned attributes' value type must be the given value type. The default is no value type filter.\n   * @param {string} options.searchFullHierarchy - Specifies if the search should include attributes nested further than the immediate attributes of the searchRoot. The default is 'false'.\n   * @param {string} options.sortField - The field or property of the object used to sort the returned collection. The default is 'Name'.\n   * @param {string} options.sortOrder - The order that the returned collection is sorted. The default is 'Ascending'.\n   * @param {string} options.startIndex - The starting index (zero based) of the items to be returned. The default is 0.\n   * @param {string} options.showExcluded - Specified if the search should include attributes with the Excluded property set. The default is 'false'.\n   * @param {string} options.showHidden - Specified if the search should include attributes with the Hidden property set. The default is 'false'.\n   * @param {string} options.maxCount - The maximum number of objects to be returned per call (page size). The default is 1000.\n   * @param {string} options.selectedFields - List of fields to be returned in the response, separated by semicolons (;). If this parameter is not specified, all available fields will be returned. See Selected Fields for more information.\n   */\n  private getAttributes(elementId: string, options: any): Promise<PiwebapiRsp[]> {\n    var querystring =\n      '?' +\n      lodash.map(options, (value, key) => {\n        return key + '=' + value;\n      }).join('&');\n\n    if (querystring === '?') {\n      querystring = '';\n    }\n\n    return this.restGet('/elements/' + elementId + '/attributes' + querystring).then(\n      (response) => response.data.Items ?? []\n    );\n  }\n\n  /**\n   * @description\n   * Retrieve elements based on the specified conditions. By default, this method selects immediate children of the current resource.\n   * Users can search for the elements based on specific search parameters. If no parameters are specified in the search, the default values for each parameter will be used and will return the elements that match the default search.\n   * GET assetdatabases/{webId}/elements\n   * @param {string} databaseId - The ID of the parent resource. See WebID for more information.\n   * @param {Object} options - Query Options\n   * @param {string} options.webId - The ID of the resource to use as the root of the search. See WebID for more information.\n   * @param {string} options.nameFilter - The name query string used for finding objects. The default is no filter. See Query String for more information.\n   * @param {string} options.categoryName - Specify that returned elements must have this category. The default is no category filter.\n   * @param {string} options.templateName - Specify that returned elements must have this template or a template derived from this template. The default is no template filter.\n   * @param {string} options.elementType - Specify that returned elements must have this type. The default type is 'Any'. See Element Type for more information.\n   * @param {string} options.searchFullHierarchy - Specifies if the search should include objects nested further than the immediate children of the searchRoot. The default is 'false'.\n   * @param {string} options.sortField - The field or property of the object used to sort the returned collection. The default is 'Name'.\n   * @param {string} options.sortOrder - The order that the returned collection is sorted. The default is 'Ascending'.\n   * @param {number} options.startIndex - The starting index (zero based) of the items to be returned. The default is 0.\n   * @param {number} options.maxCount - The maximum number of objects to be returned per call (page size). The default is 1000.\n   * @param {string} options.selectedFields -  List of fields to be returned in the response, separated by semicolons (;). If this parameter is not specified, all available fields will be returned. See Selected Fields for more information.\n   */\n  private getDatabaseElements(databaseId: string, options: any): Promise<PiwebapiRsp[]> {\n    var querystring =\n      '?' +\n      lodash.map(options, (value, key) => {\n        return key + '=' + value;\n      }).join('&');\n\n    if (querystring === '?') {\n      querystring = '';\n    }\n\n    return this.restGet('/assetdatabases/' + databaseId + '/elements' + querystring).then(\n      (response) => response.data.Items ?? []\n    );\n  }\n\n  /**\n   * @description\n   * Retrieve elements based on the specified conditions. By default, this method selects immediate children of the current resource.\n   * Users can search for the elements based on specific search parameters. If no parameters are specified in the search, the default values for each parameter will be used and will return the elements that match the default search.\n   * GET elements/{webId}/elements\n   * @param {string} databaseId - The ID of the resource to use as the root of the search. See WebID for more information.\n   * @param {Object} options - Query Options\n   * @param {string} options.webId - The ID of the resource to use as the root of the search. See WebID for more information.\n   * @param {string} options.nameFilter - The name query string used for finding objects. The default is no filter. See Query String for more information.\n   * @param {string} options.categoryName - Specify that returned elements must have this category. The default is no category filter.\n   * @param {string} options.templateName - Specify that returned elements must have this template or a template derived from this template. The default is no template filter.\n   * @param {string} options.elementType - Specify that returned elements must have this type. The default type is 'Any'. See Element Type for more information.\n   * @param {string} options.searchFullHierarchy - Specifies if the search should include objects nested further than the immediate children of the searchRoot. The default is 'false'.\n   * @param {string} options.sortField - The field or property of the object used to sort the returned collection. The default is 'Name'.\n   * @param {string} options.sortOrder - The order that the returned collection is sorted. The default is 'Ascending'.\n   * @param {number} options.startIndex - The starting index (zero based) of the items to be returned. The default is 0.\n   * @param {number} options.maxCount - The maximum number of objects to be returned per call (page size). The default is 1000.\n   * @param {string} options.selectedFields -  List of fields to be returned in the response, separated by semicolons (;). If this parameter is not specified, all available fields will be returned. See Selected Fields for more information.\n   */\n  private getElements(elementId: string, options: any): Promise<PiwebapiRsp[]> {\n    var querystring =\n      '?' +\n      lodash.map(options, (value, key) => {\n        return key + '=' + value;\n      }).join('&');\n\n    if (querystring === '?') {\n      querystring = '';\n    }\n\n    return this.restGet('/elements/' + elementId + '/elements' + querystring).then(\n      (response) => response.data.Items ?? []\n    );\n  }\n\n  /**\n   * Retrieve a list of points on a specified Data Server.\n   *\n   * @param {string} serverId - The ID of the server. See WebID for more information.\n   * @param {string} nameFilter - A query string for filtering by point name. The default is no filter. *, ?, [ab], [!ab]\n   */\n  private piPointSearch(serverId: string, nameFilter: string): Promise<PiwebapiRsp[]> {\n    let filter1 = this.templateSrv.replace(nameFilter);\n    let filter2 = `${filter1}`;\n    let doFilter = false;\n    if (filter1 !== nameFilter) {\n      const regex = /\\{(\\w|,)+\\}/gs;\n      let m;\n      while ((m = regex.exec(filter1)) !== null) {\n        // This is necessary to avoid infinite loops with zero-width matches\n        if (m.index === regex.lastIndex) {\n          regex.lastIndex++;\n        }\n\n        // The result can be accessed through the `m`-variable.\n        m.forEach((match, groupIndex) => {\n          if (groupIndex === 0) {\n            filter1 = filter1.replace(match, match.replace('{', '(').replace('}', ')').replace(',', '|'));\n            filter2 = filter2.replace(match, '*');\n            doFilter = true;\n          }\n        });\n      }\n    }\n    return this.restGet('/dataservers/' + serverId + '/points?maxCount=20&nameFilter=' + filter2).then((results) => {\n      if (!!results && !!results.data?.Items) {\n        return doFilter ? results.data.Items.filter((item) => item.Name?.match(filter1)) : results.data.Items;\n      }\n      return [];\n    });\n  }\n\n  /**\n   * Get the PI Web API webid or PI Point.\n   *\n   * @param {any} target - AF Path or Point name.\n   * @returns - webid.\n   *\n   * @memberOf PiWebApiDatasource\n   */\n  getWebId(target: any) {\n    var ds = this;\n    var isAf = target.target.indexOf('\\\\') >= 0;\n    var isAttribute = target.target.indexOf('|') >= 0;\n    if (!isAf && target.target.indexOf('.') === -1) {\n      return Promise.resolve([{ WebId: target.target, Name: target.display || target.target }]);\n    }\n\n    if (!isAf) {\n      // pi point lookup\n      return ds.piPointSearch(this.piserver.webid!, target.target).then((results) => {\n        if (results === undefined || results.length === 0) {\n          return [{ WebId: target.target, Name: target.display || target.target }];\n        }\n        return results;\n      });\n    } else if (isAf && isAttribute) {\n      // af attribute lookup\n      return ds.restGet('/attributes?path=\\\\\\\\' + target.target).then((results) => {\n        if (results.data === undefined || results.status !== 200) {\n          return [{ WebId: target.target, Name: target.display || target.target }];\n        }\n        // rewrite name if specified\n        results.data.Name = target.display || results.data.Name;\n        return [results.data];\n      });\n    } else {\n      // af element lookup\n      return ds.restGet('/elements?path=\\\\\\\\' + target.target).then((results) => {\n        if (results.data === undefined || results.status !== 200) {\n          return [{ WebId: target.target, Name: target.display || target.target }];\n        }\n        // rewrite name if specified\n        results.data.Name = target.display || results.data.Name;\n        return [results.data];\n      });\n    }\n  }\n\n\n}\n","import { DataSourcePlugin } from '@grafana/data';\n//FIXME Recreate annotation query control in react\n//import { AnnotationsQueryCtrl } from './AnnotationsQueryCtrl';\nimport { PIWebAPIConfigEditor } from './ConfigEditor';\nimport { PIWebAPIQueryEditor } from './QueryEditor';\nimport { PiWebAPIDatasource } from './datasource';\nimport { PIWebAPIQuery, PIWebAPIDataSourceJsonData } from './types';\n\nexport const plugin = new DataSourcePlugin<PiWebAPIDatasource, PIWebAPIQuery, PIWebAPIDataSourceJsonData>(\n  PiWebAPIDatasource\n)\n  .setConfigEditor(PIWebAPIConfigEditor)\n  .setQueryEditor(PIWebAPIQueryEditor);\n//  .setAnnotationQueryCtrl(AnnotationsQueryCtrl);\n\n\n\n"],"names":["module","exports","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","__WEBPACK_EXTERNAL_MODULE__2__","__WEBPACK_EXTERNAL_MODULE__4__","__WEBPACK_EXTERNAL_MODULE__5__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","FormField","LegacyForms","coerceOptions","options","jsonData","url","PIWebAPIConfigEditor","event","props","onOptionsChange","piserver","target","afserver","afdatabase","originalOptions","this","DataSourceHttpSettings","defaultUrl","dataSourceConfig","onChange","onMyOptionsChange","showAccessOptions","className","label","labelWidth","inputWidth","onPIServerChange","placeholder","onAFServerChange","onAFDatabaseChange","PureComponent","QueryField","tooltip","children","InlineFormLabel","width","QueryRowTerminator","QueryInlineField","QueryEditorRow","QueryRawInlineField","QueryRawEditorRow","defaultQuery","attributes","segments","regex","enable","summary","types","basis","interval","nodata","expression","interpolate","recordedValues","digitalStates","enableStreaming","isPiPoint","QueryEditorModeSwitcher","isRaw","useState","isModalOpen","setModalOpen","useEffect","Button","icon","variant","type","onClick","ConfirmModal","isOpen","title","body","confirmText","dismissText","onConfirm","onDismiss","LABEL_WIDTH","MIN_ATTR_INPUT_WIDTH","REMOVE_LABEL","CustomLabelComponent","Icon","name","PIWebAPIQueryEditor","summaries","attributeSegment","summarySegment","calculationBasisSegment","noDataReplacementSegment","query","setState","item","index","state","slice","remove","checkPiPointSegments","checkAttributeSegments","length","push","expandable","piServer","segmentChangeValue","currentSegment","datasource","data","ctrl","findQuery","path","getSegmentPathUpTo","Promise","resolve","metricFindQuery","assign","request","scopedVars","then","items","altSegments","map","text","webId","WebId","variables","templateSrv","getVariables","each","variable","selectableValue","unshift","err","error","message","attributeText","getSelectedPIServer","pointName","Path","forOwn","availableAttributes","val","segmentsArray","attributesArray","splitAttributes","split","splitElements","splice","_","getElementSegments","elements","summariesArray","cb","initialLoad","scopedVarsDone","force","metricsQuery","defaults","buildFromTarget","_segmentsArray","updateArray","e","checkAfServer","onRunQuery","rawQuery","elementPath","join","s","queryChange","onSegmentChange","bind","calcBasisValueChanged","calcNoDataValueChanged","onSummaryAction","onSummaryValueChanged","onAttributeAction","onAttributeChange","summaryTypes","calculationBasis","noDataReplacement","segment","isValueEmpty","stateCallback","filter","indexOf","part","attributeChangeValue","arr","reduce","result","startsWith","attributesResponse","validAttributes","attribute","substring","filteredAttributes","attrib","changedValue","replace","webID","forEach","parts","match","queryProps","display","InlineField","InlineSwitch","onIsPiPointChange","InlineFieldRow","grow","Input","onBlur","textEditorChanged","SegmentAsync","Component","loadOptions","allowCustomValue","inputMinWidth","disabled","onPiPointChange","getAttributeSegmentsPI","reloadOptionsOnChange","Segment","getAttributeSegmentsAF","maxNumber","parseInt","getNoDataSegments","getCalcBasisSegments","getSummarySegments","search","i","PiWebAPIDatasource","instanceSettings","getTemplateSrv","webid","annotations","queryOptions","ds","querydepth","JSON","parse","Math","max","min","getAssetServer","metricQueryTransform","getAssetServers","server","getDatabases","getDatabase","db","getDatabaseElements","selectedFields","getElement","element","getElements","nameFilter","getAttributes","searchFullHierarchy","getDataServers","piPointSearch","reject","response","lodash","Name","HasChildren","Items","getBackendSrv","datasourceRequest","id","method","headers","restGet","serverId","databaseId","InstanceType","elementId","querystring","filter1","filter2","doFilter","m","exec","lastIndex","groupIndex","results","isAf","isAttribute","status","DataSourceWithBackend","plugin","DataSourcePlugin","setConfigEditor","setQueryEditor"],"sourceRoot":""}